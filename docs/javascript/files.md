# JavaScript: Files

You can load files — whether static or dynamically generated by a [data loader](../loaders) — with the built-in `FileAttachment` function. This is available by default in Markdown, but you can import it like so:

```js echo
import {FileAttachment} from "npm:@observablehq/stdlib";
```

`FileAttachment` supports many common data formats (listed below). For example, here is a JSON file:

```js echo
const volcano = FileAttachment("volcano.json").json();
```

The value of `volcano` above is a [promise](./promises). In other code blocks, the promise is resolved implicitly and hence you can refer to the resolved value directly.

```js echo
volcano
```

The `FileAttachment` function returns a `file` object that exposes the file’s name and [MIME type](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types).

```js echo
FileAttachment("volcano.json")
```

Calling `FileAttachment` doesn’t actually load the file — it only (synchronously) returns the file’s metadata. The contents aren’t loaded until you request it using one of the type-specific methods below.

## Static analysis

We use static analysis to determine which files are used so that we can include only referenced files when building. The `FileAttachment` function accepts only literal strings; code such as `FileAttachment("my" + "file.csv")` or similar dynamic invocation is invalid syntax. If you have multiple files, you need to enumerate them explicitly like so:

```js run=false
const frames = [
  FileAttachment("frame1.png"),
  FileAttachment("frame2.png"),
  FileAttachment("frame3.png"),
  FileAttachment("frame4.png"),
  FileAttachment("frame5.png"),
  FileAttachment("frame6.png"),
  FileAttachment("frame7.png"),
  FileAttachment("frame8.png"),
  FileAttachment("frame9.png")
];
```

Note that just declaring a `FileAttachment` does not load the file. Hence above, none of the files in `frames` are loaded until requested, for example by saying `frames[0].image()`.

## Supported formats

The following file formats have built-in support with `FileAttachment`:

| method             | return type                                | supporting library
| -                  | -                                          | -
| `file.arrayBuffer` | ArrayBuffer                                | -
| `file.arrow`       | Arrow Table                                | [Apache Arrow](../lib/arrow)
| `file.blob`        | Blob                                       | -
| `file.csv`         | Array (or objects or arrays)               | [D3](../lib/csv)
| `file.html`        | Document                                   | -
| `file.image`       | Image                                      | -
| `file.json`        | Array, Object, or other value              | -
| `file.parquet`     | Arrow Table                                | [Apache Arrow, parquet-wasm](../lib/arrow)
| `file.sqlite`      | SQLiteDatabaseClient                       | SQLite
| `file.stream`      | ReadableStream                             | -
| `file.text`        | string                                     | -
| `file.tsv`         | Array (or objects or arrays)               | [D3](../lib/csv)
| `file.xlsx`        | Workbook                                   | [ExcelJS](../lib/xslx)
| `file.xml`         | XMLDocument                                | -
| `file.zip`         | ZipArchive                                 | [JSZip](../lib/zip)
| `file.url`         | string                                     | -

While the file contents often dictate the appropriate method (for example, an Apache Arrow file is typically read with `file.arrow`), when multiple methods are valid you should chose based on your needs. For example, you can load a CSV file using `file.text` if you’d prefer to implement parsing yourself instead of using the built-in CSV parser.

## Basic formats

The following basic formats are supported natively.

### Text

To load text from a humble text file (like the source code of this very page), use `file.text()`:

```js echo
const source = await FileAttachment("files.md").text();
display(html`<em>This page has ${source.split("\n\n").length} paragraphs.`)
```

This method expects the file to be encoded in [UTF-8](https://en.wikipedia.org/wiki/UTF-8). (If this is not the case, use [TextDecoder](https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder).)

### JSON

A common way to serialize non-tabular data such as networks and hierarchies, or data with multivalued fields (_e.g._, tags), is to use [JSON](https://en.wikipedia.org/wiki/JSON), the JavaScript Object Notation—for example with [JSON.stringify](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).

The `file.json()` method reads a .json file and returns a promise to a JavaScript object:

```js echo
FileAttachment("volcano.json").json()
```

See [D3](../lib/d3) for a complete example.

### Media

All types of images can be added, in any of the formats supported by your browser: PNG, JPEG, gif, WebP, TIFF, SVG, etc. The simplest way to display an image is to use the `file.image()` method:

```js echo
FileAttachment("horse.jpg").image({width: 640, alt: "Horse"})
```

The options, if any, are assigned directly as properties of the [Image](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/Image) element; for example, you can set an image’s _width_ and _height_, a _style_ attribute, or the _alt_ attribute like above.

When you need to work with the image pixels or raw contents, you will either write the image to a canvas element, then read the bytes with [context.getImageData](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData).

For audio or video contents, you will use the `file.url()` method to build a player element with the source URL it returns (as a promise). For example:

```js echo
html`<video ${{
  src: await FileAttachment("horse.mp4").url(),
  autoplay: true,
  muted: true,
  loop: true,
  controls: true
}}>`
```

### Markup

The `file.xml(mimeType)` method read a [XML]() file and returns a promise to a [XMLDocument](https://developer.mozilla.org/en-US/docs/Web/API/XMLDocument) containing the contents of the file. It takes a single argument with the file’s MIME-type, which defaults to `"application/xml"`.

The `file.html()` method reads an [HTML](https://developer.mozilla.org/en-US/docs/Web/HTML) file and returns a Document which you can [traverse](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Traversing_an_HTML_table_with_JavaScript_and_DOM_Interfaces) with the standard methods, or manipulate with [D3](../lib/d3). `file.html()` is equivalent to `file.xml("text/html")`.

## Binary formats

You can also get a [ReadableStream](https://streams.spec.whatwg.org/#rs) if you want to read a file incrementally:

```js echo run=false
function* chunk() {
  const stream = await FileAttachment("example.shp").stream();
  const reader = stream.getReader();
  let done, value;
  while (({done, value} = await reader.read()), !done) {
    yield value;
  }

for (const value of chunk) { … do something with the value … }
```

Likewise, call `file.blob()` to get a [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob).

Or, you can load the image into an array buffer, and process its raw format directly. For example, to read the [EXIF](https://en.wikipedia.org/wiki/Exif) metadata of a picture with [ExifReader](https://github.com/mattiasw/ExifReader):

```js echo
import ExifReader from "npm:exifreader";
```

```js echo
FileAttachment("horse.jpg").arrayBuffer().then(ExifReader.load)
```

(Image from [Eadweard Muybridge](https://www.loc.gov/search/?fa=contributor:muybridge,+eadweard)’s studies of animal locomotion.)
