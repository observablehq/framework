---
sql:
  gaia: ./lib/gaia-sample.parquet
---

# SQL

Observable Framework includes built-in support for client-side SQL powered by [DuckDB](./lib/duckdb). You can use SQL to query data from [CSV](./lib/csv), [TSV](./lib/csv), [JSON](./javascript/files#json), [Apache Arrow](./lib/arrow), and [Apache Parquet](./lib/arrow#apache-parquet) files. These files can either be static or generated by [data loaders](./loaders).

## SQL front matter

To use SQL, first register the desired tables in the page’s [front matter](./markdown#front-matter) using the **sql** option. This option takes an object, where each key is a table name and each value is the to the corresponding data file. For example, to register a table named `gaia` with data from a Parquet file:

```yaml
---
sql:
  gaia: ./lib/gaia-sample.parquet
---
```

## SQL code blocks

To run SQL queries, create a SQL fenced code block (<code>```sql</code>). For example, to query the first 10 rows from the `gaia` table:

````md
```sql
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 10
```
````

This produces a table:

```sql
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 10
```

To refer to the results of a query in JavaScript, use the `id` directive. For example, to refer to the results of the previous query as `top10`:

````md
```sql id=top10
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 10
```
````

```sql id=top10
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 10
```

This returns an array of 10 rows:

```js echo
top10
```

The `id` directive supports destructuring, so you can refer to individual rows and columns. For example, to pull out the top row:

````md
```sql id=[top]
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 1
```
````

```sql id=[top]
SELECT * FROM gaia ORDER BY phot_g_mean_mag LIMIT 1
```

```js echo
top
```

To pull out the minimum value of the `phot_g_mean_mag` column:

````md
```sql id=[{min}]
SELECT MIN(phot_g_mean_mag) AS min FROM gaia
```
````

```sql id=[{min}]
SELECT MIN(phot_g_mean_mag) AS min FROM gaia
```

```js echo
min
```

Another example…

```sql id=bins echo
SELECT
  floor(ra / 2) * 2 + 1 AS ra,
  floor(dec / 2) * 2 + 1 AS dec,
  count() AS count
FROM
  gaia
GROUP BY
  1,
  2
```

```js echo
Plot.plot({
  aspectRatio: 1,
  x: {domain: [0, 360]},
  y: {domain: [-90, 90]},
  marks: [
    Plot.frame({fill: 0}),
    Plot.raster(bins, {
      x: "ra",
      y: "dec",
      fill: "count",
      width: 360 / 2,
      height: 180 / 2,
      imageRendering: "pixelated"
    })
  ]
})
```

## SQL literals

You can also invoke the `sql` tagged template literal directly.

```js echo
const rows = await sql`SELECT random() AS random`;
```

```js echo
rows[0].random
```
